# р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕гр╕░р╕Ър╕Ър╕кр╕Цр╕▓р╕Щр╕░ (Status System Update)

## р╕гр╕░р╕Ър╕Ър╕кр╕Цр╕▓р╕Щр╕░р╣Гр╕лр╕бр╣И

### р╕гр╕лр╕▒р╕кр╕кр╕Цр╕▓р╕Щр╕░ (Status Codes)
- **10** = р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ (Pending Approval)
- **20** = р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г (Pending/Waiting to Start)
- **30** = р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И (Waiting for Parts)
- **40** = р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ (Completed)

### р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ър╣Ар╕Фр╕┤р╕б
- ~~0~~ тЖТ **20** (р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г)
- ~~1~~ тЖТ **40** (р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ)
- ~~2~~ тЖТ **30** (р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И)
- **р╣Ар╕Юр╕┤р╣Ир╕бр╣Гр╕лр╕бр╣И** тЖТ **10** (р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤)

---

## р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕нр╕▒р╕Ыр╣Ар╕Фр╕Х

### 1. Database Schema
**File:** `/var/www/html/mt/sql/update_status_system.sql`
- р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ column `stutus` р╣Ар╕Ыр╣Зр╕Щ `status` (р╣Бр╕Бр╣Й typo)
- р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Кр╕Щр╕┤р╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Б VARCHAR р╣Ар╕Ыр╣Зр╕Щ INT(11)
- р╕Бр╕│р╕лр╕Щр╕Ф default value = 20 (р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г)
- Migrate р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Фр╕┤р╕бр╣Др╕Ыр╕вр╕▒р╕Зр╕гр╕лр╕▒р╕кр╣Гр╕лр╕бр╣И

**р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕гр╕▒р╕Щ:**
```bash
mysql -h 192.168.0.44 -u user -puser automotive < /var/www/html/mt/sql/update_status_system.sql
```

### 2. Configuration File
**File:** `/var/www/html/mt/config/config.php`

**р╣Ар╕Юр╕┤р╣Ир╕б Constants:**
```php
define('STATUS_PENDING_APPROVAL', 10);  // р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
define('STATUS_PENDING', 20);            // р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г
define('STATUS_WAITING_PARTS', 30);      // р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И
define('STATUS_COMPLETED', 40);          // р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ
```

**р╣Ар╕Юр╕┤р╣Ир╕б Helper Functions:**
- `get_status_text($status_code)` - р╣Бр╕Ыр╕ер╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Ыр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕в
- `get_status_badge_class($status_code)` - р╕Др╕╖р╕Щр╕Др╣Ир╕▓ Bootstrap badge class

### 3. API Endpoints

#### `/var/www/html/mt/api/save.php`
- р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х default status = `STATUS_PENDING` (20)
- р╣Бр╕Бр╣Йр╣Др╕В column name: `stutus` тЖТ `status`

#### `/var/www/html/mt/api/update_status.php`
- р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х validation: р╕гр╕нр╕Зр╕гр╕▒р╕Ъ 10, 20, 30, 40
- р╣Бр╕Бр╣Йр╣Др╕В column name: `stutus` тЖТ `status`
- р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х `$statusNames` array р╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Чр╕╕р╕Бр╕кр╕Цр╕▓р╕Щр╕░

#### `/var/www/html/mt/api/get_all_repairs.php`
- р╣Бр╕Бр╣Йр╣Др╕В column name: `stutus` тЖТ `status`
- Filter р╕Чр╕│р╕Зр╕▓р╕Щр╕Бр╕▒р╕Ър╕гр╕лр╕▒р╕кр╕Хр╕▒р╕зр╣Ар╕ер╕В

### 4. Frontend Pages

#### `/var/www/html/mt/pages/machines.php`
**Filter Dropdown:**
```html
<option value="10">р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</option>
<option value="20">р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</option>
<option value="30">р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И</option>
<option value="40">р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ</option>
```

**JavaScript Switch Cases:**
```javascript
switch(parseInt(repair.status)) {
    case 10: // р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ - badge-secondary
    case 20: // р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г - badge-warning
    case 30: // р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И - badge-info
    case 40: // р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ - badge-success
}
```

#### `/var/www/html/mt/pages/monitor.php`
**getStatusInfo():** р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х 4 cases р╕Юр╕гр╣Йр╕нр╕б icon р╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
- 10: clipboard-check (р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤)
- 20: clock (р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г)
- 30: hourglass-half (р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И)
- 40: check-circle (р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ)

**getActionButtons():** workflow р╕Ыр╕╕р╣Ир╕бр╕Хр╕▓р╕бр╕кр╕Цр╕▓р╕Щр╕░
- р╕кр╕Цр╕▓р╕Щр╕░ 10 тЖТ р╕Ыр╕╕р╣Ир╕б "р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤" (р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Ыр╣Зр╕Щ 20)
- р╕кр╕Цр╕▓р╕Щр╕░ 20 тЖТ р╕Ыр╕╕р╣Ир╕б "р╣Ар╕кр╕гр╣Зр╕И" (40), "р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И" (30)
- р╕кр╕Цр╕▓р╕Щр╕░ 30 тЖТ р╕Ыр╕╕р╣Ир╕б "р╣Ар╕кр╕гр╣Зр╕И" (40), "р╕Бр╕ер╕▒р╕Ъ" (20)
- р╕кр╕Цр╕▓р╕Щр╕░ 40 тЖТ р╕Ыр╕╕р╣Ир╕б "р╕вр╕Бр╣Ар╕ер╕┤р╕Б" (20)

**getRowClass():** CSS class р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░р╕кр╕Цр╕▓р╕Щр╕░
- 10, 20 тЖТ row-pending
- 30 тЖТ row-waiting
- 40 тЖТ row-completed

**CSS:** р╣Ар╕Юр╕┤р╣Ир╕б `.btn-approve` р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕╕р╣Ир╕бр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤

**calculateElapsedTime():** р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕Кр╣Зр╕Др╕Ир╕▓р╕Б `status == 1` р╣Ар╕Ыр╣Зр╕Щ `status == 40`

#### `/var/www/html/mt/pages/repair_form.php`
**Filter Dropdown:**
```html
<option value="10">ЁЯУЛ р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</option>
<option value="20">тП│ р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</option>
<option value="30">тЪЩя╕П р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И</option>
<option value="40">тЬУ р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ</option>
```

---

## Workflow р╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕░

### 1. р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ (10)
- р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ: р╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╕Лр╣Ир╕нр╕бр╣Гр╕лр╕бр╣И (р╕Цр╣Йр╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕гр╕░р╕Ър╕Ър╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤)
- р╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╕бр╕╡: [р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤ тЖТ 20]

### 2. р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г (20)
- р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ: р╕кр╕Цр╕▓р╕Щр╕░ default р╣Ар╕бр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Гр╕лр╕бр╣И
- р╕Ир╕▓р╕Бр╕кр╕Цр╕▓р╕Щр╕░: 10 (р╕лр╕ер╕▒р╕Зр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤), 30 (р╕Бр╕ер╕▒р╕Ър╕Ир╕▓р╕Бр╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И), 40 (р╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕Зр╕▓р╕Щр╣Ар╕кр╕гр╣Зр╕И)
- р╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╕бр╕╡: [р╣Ар╕кр╕гр╣Зр╕И тЖТ 40], [р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И тЖТ 30]

### 3. р╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И (30)
- р╕Ир╕▓р╕Бр╕кр╕Цр╕▓р╕Щр╕░: 20 (р╣Ар╕бр╕╖р╣Ир╕нр╕Юр╕Ър╕зр╣Ир╕▓р╕Хр╣Йр╕нр╕Зр╕гр╕нр╕нр╕░р╣Др╕лр╕ер╣И)
- р╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╕бр╕╡: [р╣Ар╕кр╕гр╣Зр╕И тЖТ 40], [р╕Бр╕ер╕▒р╕Ъ тЖТ 20]

### 4. р╕Лр╣Ир╕нр╕бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ (40)
- р╕Ир╕▓р╕Бр╕кр╕Цр╕▓р╕Щр╕░: 20, 30 (р╣Ар╕бр╕╖р╣Ир╕нр╕Зр╕▓р╕Щр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М)
- р╕Ыр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╕бр╕╡: [р╕вр╕Бр╣Ар╕ер╕┤р╕Б тЖТ 20]

---

## р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### 1. р╕Чр╕Фр╕кр╕нр╕Ър╕лр╕Щр╣Йр╕▓ Monitor
- [ ] р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Чр╕╕р╕Бр╕гр╕▓р╕вр╕Бр╕▓р╕г
- [ ] р╕Ыр╕╕р╣Ир╕бр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕░р╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] р╕кр╕╡р╣Бр╕ер╕░ icon р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] р╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╣Ар╕зр╕ер╕▓р╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З (р╣Ар╕Йр╕Юр╕▓р╕░р╕кр╕Цр╕▓р╕Щр╕░ 40)

### 2. р╕Чр╕Фр╕кр╕нр╕Ър╕лр╕Щр╣Йр╕▓ Machines (MT Portal)
- [ ] Filter р╕Хр╕▓р╕бр╕кр╕Цр╕▓р╕Щр╕░р╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] Badge р╣Бр╕кр╕Фр╕Зр╕кр╕╡р╣Бр╕ер╕░р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [ ] р╕Др╣Йр╕Щр╕лр╕▓р╕Хр╕▓р╕бр╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕ер╕░р╣Ар╕ер╕Вр╕Чр╕╡р╣Ир╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### 3. р╕Чр╕Фр╕кр╕нр╕Ър╕лр╕Щр╣Йр╕▓ Repair Form
- [ ] Filter dropdown р╣Бр╕кр╕Фр╕Зр╕Др╕гр╕Ъ 4 р╕кр╕Цр╕▓р╕Щр╕░
- [ ] р╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▓р╕бр╕кр╕Цр╕▓р╕Щр╕░р╣Др╕Фр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### 4. р╕Чр╕Фр╕кр╕нр╕Ъ API
- [ ] POST `/api/save.php` - р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Йр╕кр╕Цр╕▓р╕Щр╕░ 20
- [ ] POST `/api/update_status.php` - р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕░р╣Др╕Фр╣Йр╕Чр╕╕р╕Б case
- [ ] POST `/api/get_all_repairs.php` - filter р╕Хр╕▓р╕б status р╣Др╕Фр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

---

## Rollback Plan

р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕вр╣Йр╕нр╕Щр╕Бр╕ер╕▒р╕Ъ:

```sql
-- Rollback status values
UPDATE mt_repair SET status = 0 WHERE status = 20;
UPDATE mt_repair SET status = 1 WHERE status = 40;
UPDATE mt_repair SET status = 2 WHERE status = 30;

-- Rollback column type (if needed)
ALTER TABLE mt_repair 
MODIFY COLUMN status VARCHAR(50) DEFAULT 'р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г';
```

**Note:** р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕Вр╣Вр╕Др╣Йр╕Фр╕Чр╕╕р╕Бр╣Др╕Яр╕ер╣Мр╕Бр╕ер╕▒р╕Ър╣Др╕Ыр╣Гр╕Кр╣Йр╕Др╣Ир╕▓р╣Ар╕Фр╕┤р╕б (0, 1, 2) р╕Фр╣Йр╕зр╕в

---

## р╕кр╕гр╕╕р╕Ы

тЬЕ **р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М**
- Database schema updated
- Constants р╣Бр╕ер╕░ helper functions created
- API endpoints updated (3 files)
- Frontend pages updated (3 files)
- Status workflow р╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ 4 р╕кр╕Цр╕▓р╕Щр╕░

ЁЯУЭ **р╕Вр╣Йр╕нр╣Бр╕Щр╕░р╕Щр╕│**
- р╕Др╕зр╕гр╕Чр╕Фр╕кр╕нр╕Ър╕Чр╕╕р╕Б workflow р╕Бр╣Ир╕нр╕Щр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З
- р╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓р╕зр╣Ир╕▓р╕Ир╕░р╣Гр╕Кр╣Йр╕кр╕Цр╕▓р╕Щр╕░ "р╕гр╕нр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤" (10) р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
- р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕Цр╕▓р╕Щр╕░р╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Йр╣Гр╕Щр╕нр╕Щр╕▓р╕Др╕Х (р╣Ар╕Кр╣Ир╕Щ 50, 60)
